# External CRDs

These CRDs are owned by upstream projects and are vendored here for local
`envtest` usage and Helm chart distribution.  They are **not** generated by
this repository â€” update them manually from the sources listed below.

## Sources

| File | Source module | Versions in go.mod |
|------|--------------|-------------------|
| `agent-crd.yaml` | `github.com/kagent-dev/kagent/go` | `v0.0.0-20251107200645-686008ea62ac` |
| `remotemcpserver-crd.yaml` | `github.com/kagent-dev/kagent/go` | (same as above) |
| `modelconfig-crd.yaml` | `github.com/kagent-dev/kagent/go` | (same as above) |
| `mcpserver-crd.yaml` | `github.com/kagent-dev/kmcp` | `v0.2.2` |

## How to update

1. Bump the dependency in `go.mod`:
   ```bash
   go get github.com/kagent-dev/kagent/go@<new-version>
   go get github.com/kagent-dev/kmcp@<new-version>
   go mod tidy
   ```

2. Copy the CRD manifests from the module cache:
   ```bash
   # kagent CRDs (agent, remotemcpserver, modelconfig)
   KAGENT=$(go env GOMODCACHE)/github.com/kagent-dev/kagent/go@$(grep 'kagent/go' go.mod | awk '{print $2}')
   cp "$KAGENT"/api/v1alpha2/agents.yaml         config/external-crds/agent-crd.yaml
   cp "$KAGENT"/api/v1alpha2/remotemcpservers.yaml config/external-crds/remotemcpserver-crd.yaml
   cp "$KAGENT"/api/v1alpha2/modelconfigs.yaml   config/external-crds/modelconfig-crd.yaml

   # kmcp CRD (mcpserver)
   KMCP=$(go env GOMODCACHE)/github.com/kagent-dev/kmcp@$(grep 'kagent-dev/kmcp' go.mod | awk '{print $2}')
   cp "$KMCP"/config/crd/bases/kagent.dev_mcpservers.yaml config/external-crds/mcpserver-crd.yaml
   ```
   > **Note:** The exact source paths inside each module may shift between releases.
   > Verify with `find $KAGENT -name "*.yaml" | grep -i crd` if a path no longer exists.

3. Run `make test` to confirm envtest still works with the updated CRDs.
